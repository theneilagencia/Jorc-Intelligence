name: "ğŸš€ Deploy to Render"

on:
  push:
    branches:
      - main

jobs:
  deploy:
    name: "Trigger Render Deployment"
    runs-on: ubuntu-latest

    steps:
      - name: "ğŸ§© Checkout repository"
        uses: actions/checkout@v4

      - name: "ğŸ§  Show Git info"
        run: |
          echo "âœ… Branch: ${{ github.ref }}"
          echo "âœ… Commit: ${{ github.sha }}"
          echo "âœ… Actor: ${{ github.actor }}"
          echo "âœ… Repository: ${{ github.repository }}"

      - name: "ğŸš€ Trigger Render deploy"
        env:
          RENDER_DEPLOY_HOOK: ${{ secrets.RENDER_DEPLOY_HOOK }}
        run: |
          echo "ğŸ”— Triggering Render deploy..."
          if [ -z "$RENDER_DEPLOY_HOOK" ]; then
            echo "âŒ ERROR: Secret RENDER_DEPLOY_HOOK is missing!"
            exit 1
          fi

          RESPONSE=$(curl -s -o /tmp/render_response.json -w "%{http_code}" -X POST "$RENDER_DEPLOY_HOOK")

          if [ "$RESPONSE" -eq 200 ] || [ "$RESPONSE" -eq 202 ]; then
            echo "âœ… Deploy triggered successfully on Render!"
            cat /tmp/render_response.json
          else
            echo "âŒ Failed to trigger Render deploy (HTTP $RESPONSE)"
            cat /tmp/render_response.json
            exit 1
          fi
